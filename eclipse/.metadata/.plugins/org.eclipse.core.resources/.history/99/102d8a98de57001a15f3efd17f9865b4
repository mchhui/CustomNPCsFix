package mchhui.customnpcsfix.util;

import java.lang.reflect.Field;
import java.lang.reflect.Type;
import java.util.HashMap;
import java.util.Map;

import com.google.gson.GsonBuilder;
import com.google.gson.InstanceCreator;

import net.minecraft.nbt.NBTTagCompound;
import noppes.npcs.util.JsonException;

public class NBTJsonUtil {
    
    public static String Convert(NBTTagCompound compound) {
        HashMap tagMap=null;
        Field tagMapField=null;
        try {
            tagMapField=NBTTagCompound.class.getDeclaredField("tagMap");
        } catch (NoSuchFieldException | SecurityException e) {
            try {
                tagMapField=NBTTagCompound.class.getDeclaredField("field_74784_a");
            } catch (NoSuchFieldException | SecurityException e1) {
                // TODO 自动生成的 catch 块
                e1.printStackTrace();
            }
        }
        try {
            tagMapField.setAccessible(true);
            tagMap=(HashMap) tagMapField.get(compound);
        } catch (IllegalArgumentException | IllegalAccessException e) {
            // TODO 自动生成的 catch 块
            e.printStackTrace();
        }
        return new GsonBuilder().setPrettyPrinting().disableHtmlEscaping().create().toJson(tagMap);
    }

    public static NBTTagCompound Convert(String json) throws JsonException {
        return NBTJsonUtil.Convert(json);
    }
    
    private static class NBTTagCompoundInstanceCreator implements InstanceCreator<HashMap>{

        @Override
        public Object createInstance(Type type) {
            // TODO 自动生成的方法存根
            return null;
        }
        
    }
}
